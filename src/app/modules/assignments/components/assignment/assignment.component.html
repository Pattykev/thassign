<div [formGroup]="form" *ngIf="isEditMode; else assignmentDisplay">
  <div formArrayName="{{ wIndex }}">
    <div
      fxLayout="row"
      formGroupName="{{ assignment.position }}"
      fxLayoutAlign="space-around center"
    >
      <div fxFlex="5">
        <button
          mat-button
          type="button"
          mat-icon-button
          [disabled]="form.disabled"
          (click)="removeAssignment()"
        >
          <mat-icon>close</mat-icon>
        </button>
      </div>
      <!-- PART -->
      <div fxFlex="30" fxFlex.lt-sm="auto">
        <!-- <app-picker
          title="{{ 'choose-assignment' | translate | titlecase }}"
          placeholder="{{ 'assignment' | translate | titlecase }}"
          [form]="form"
          [controlPath]="[wIndex, assignment.position, 'part']"
          [options]="listOfParts"
          labelField="name"
          (selectionChange)="onPartChange($event)">
        </app-picker> -->

        <mat-form-field fxFill>
          <mat-select
            placeholder="{{ 'assignment' | translate | titlecase }}"
            [compareWith]="compareFn"
            formControlName="part"
            (selectionChange)="onPartChange($event)"
          >
            <mat-select-trigger>
              {{
                form.get([wIndex, assignment.position, "part"]).value?.name
                  | translate
              }}
            </mat-select-trigger>

            <mat-option *ngFor="let part of listOfParts" [value]="part">
              {{ part.name | translate }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <!-- ASSIGNEE -->
      <div fxFlex="30" fxFlex.lt-sm="auto">
        <!-- <ng-template #assignableList>
          <mat-selection-list
            #options
            [multiple]="false"
            (selectionChange)="closeDialog()"
          >
            <mat-list-option
              *ngFor="
                let user of assignableListByPart[
                  form.get([wIndex, assignment.position, 'part']).value?.name
                ];
                let isFirst = first
              "
              [value]="user"
              cdkFocusInitial
            >
              <h3 matLine>{{ user.fullName }}</h3>
              <span matLine>Last {{ user.assignments.length }}</span>
              <span matLine>
                Last
                {{
                  user.assignments[0]?.week.toISOString()
                    | translateDate: "DATE_SHORT"
                    | async
                }}
              </span>
            </mat-list-option>
          </mat-selection-list>
        </ng-template> -->
        <!-- [optionsTemplate]="assignableList" -->
        <app-picker
          *ngIf="form.get([wIndex, assignment.position, 'part']).value"
          [optionsTemplate]="displayComponentRef.componentType"
          [title]="form.get([wIndex, assignment.position, 'part']).value?.name"
          placeholder="{{ 'assignee' | translate | titlecase }}"
          [form]="form"
          [controlPath]="[wIndex, assignment.position, 'assignee']"
          [options]="
            assignableListByPart[
              form.get([wIndex, assignment.position, 'part']).value?.name
            ]
          "
          labelField="fullName"
        ></app-picker>

        <!-- <mat-form-field
          fxFill
          *ngIf="form.get([wIndex, assignment.position, 'part']).value"
        >
          <mat-select
            placeholder="{{ 'assignee' | translate | titlecase }}"
            [compareWith]="compareFn"
            formControlName="assignee"
          >
            <mat-select-trigger>
              {{ assignment.assignee?.fullName }}
            </mat-select-trigger>

            <mat-option
              *ngFor="
                let assignee of assignableListByPart[
                  form.get([wIndex, assignment.position, 'part']).value?.name
                ]
              "
              [value]="assignee"
            >
              {{ assignee.fullName }}
            </mat-option>
          </mat-select>
        </mat-form-field> -->
      </div>
      <!-- ASSISTANT -->
      <div fxFlex="30" fxFlex.lt-sm="auto">
        <app-picker
          *ngIf="
            form.get([wIndex, assignment.position, 'part']).value?.withAssistant
          "
          [optionsTemplate]="displayComponentRef.componentType"
          title="{{ 'assistant' | translate | titlecase }}"
          placeholder="{{ 'assistant' | translate | titlecase }}"
          [form]="form"
          [controlPath]="[wIndex, assignment.position, 'assistant']"
          [options]="assignableListByPart['clm.ministry.assistant']"
          labelField="fullName"
        ></app-picker>
        <!-- <mat-form-field fxFill>
          <mat-select
            placeholder="{{ 'assistant' | translate | titlecase }}"
            [compareWith]="compareFn"
            formControlName="assistant"
          >
            <mat-select-trigger>
              {{ assignment.assistant?.fullName }}
            </mat-select-trigger>

            <mat-option
              *ngFor="
                let assistant of assignableListByPart['clm.ministry.assistant']
              "
              [value]="assistant"
            >
              {{ assistant.fullName }}
            </mat-option>
          </mat-select>
        </mat-form-field> -->
      </div>
    </div>
  </div>
</div>

<!-- ASSIGNMENT DISPLAY -->
<ng-template #assignmentDisplay>
  <div fxLayout="row wrap" fxLayoutAlign="start center">
    <!-- PART -->
    <div
      fxFlex="30"
      fxFlex.lt-sm="100"
      fxFlexOffset="5"
      class="assignment-name"
    >
      {{ assignment.part.name | translate }}
    </div>
    <!-- ASSIGNEE & ASSISTANT -->
    <div fxFlex="50" fxFlex.lt-sm="100" fxFlexOffset.lt-sm="10">
      <span class="assignment-assignee">
        {{ assignment.assignee?.fullName }}
      </span>
      <span *ngIf="assignment.part.withAssistant" class="assignment-assistant">
        / {{ assignment.assistant?.fullName }}
      </span>
    </div>
  </div>
</ng-template>
